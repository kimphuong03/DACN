@model IEnumerable<WEBTRUYEN.Models.Product>

@{
    ViewData["Title"] = "Sản phẩm đã theo dõi";
}
<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Anime Template">
    <meta name="keywords" content="Anime, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Anime | Template</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="/css/plyr.css" type="text/css">
    <link rel="stylesheet" href="/css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Header Section Begin -->
    <header class="header">
        <div class="container">
            <div class="row">
                <div class="col-lg-2">
                    <div class="header__logo">
                        <a href="@Url.Action("Index", "Home")">
                            <img src="/img/logo2.png" alt="Logo">
                        </a>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div class="header__nav">
                        <nav class="header__menu mobile-menu">
                            <ul class="navbar">
                                <li>
                                    <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Index">Homepage</a>
                                </li>
                                <li>
                                    <a class="nav-link text-dark" asp-area="" asp-controller="Categories" asp-action="Index">Categories</a>
                                </li>

                                <li>
                                    <a href="#">Setting <span class="arrow_carrot-down"></span></a>
                                    <ul class="dropdown">
                                        <li>
                                            <a asp-area="" asp-controller="PremiumPackage" asp-action="Index">PremiumPackage</a>
                                        </li>
                                        <li>
                                            <a asp-area="" asp-controller="Follow" asp-action="myfollows">My Follows</a>
                                        </li>

                                    </ul>
                                </li>
                                <partial name="_LoginPartial" />
                            </ul>
                        </nav>
                    </div>
                </div>

                @* <div class="col-lg-2">
                <div class="header__right">
                <a href="#" class="search-switch"><span class="icon_search"></span></a>
                <a class="nav-link text-dark" asp-area="Identity" asp-page="/Account/Login"><span class="icon_profile"></span></a>

                </div>
                </div> *@
            </div>
            <div id="mobile-menu-wrap"></div>
        </div>
    </header>



    <!-- Header End -->
    @*  <div class="container my-5">
    <h2 class="text-center mb-5" style="font-weight: 700; font-size: 2rem; color: #4c4c4c;">Các sản phẩm bạn đã theo dõi</h2>

    @if (Model.Any())
    {
    <div class="row g-4">
    @foreach (var product in Model)
    {
    <div class="col-lg-3 col-md-4 col-sm-6">
    <div class="card product-card shadow-sm border-0 h-100">
    <div class="position-relative overflow-hidden" style="height: 240px;">
    <img src="@product.ImageUrl" class="card-img-top img-fluid" alt="@product.Name"
    style="object-fit: cover; height: 100%; transition: transform 0.3s;">
    <div class="overlay d-flex align-items-center justify-content-center">
    <a href="@Url.Action("Details", "Product", new { id = product.Id })"
    class="btn btn-light btn-sm text-dark">Chi tiết</a>
    </div>
    </div>
    <div class="card-body d-flex flex-column">
    <h5 class="card-title text-center" style="font-weight: 600;">@product.Name</h5>
    <p class="card-text text-muted text-truncate">@product.Description</p>
    <div class="d-flex justify-content-between mt-auto">
    <a href="@Url.Action("Details", "Product", new { id = product.Id })"
    class="btn btn-outline-primary btn-sm">
    <i class="fa fa-info-circle me-1"></i> Xem chi tiết
    </a>
    <form asp-action="UnfollowProduct" method="post" style="display:inline;">
    <input type="hidden" name="productId" value="@product.Id" />
    <button type="submit" class="btn btn-outline-danger btn-sm">
    <i class="fa fa-times-circle me-1"></i> Bỏ theo dõi
    </button>
    </form>
    </div>
    </div>
    </div>
    </div>
    }
    </div>
    }
    else
    {
    <p class="text-center text-muted" style="font-size: 1.2rem; margin-top: 50px;">
    Bạn chưa theo dõi sản phẩm nào.
    </p>
    }
    </div> *@


    <div class="container my-5">
        <h2 class="text-center mb-5" style="font-weight: 700; font-size: 2rem; color: #4c4c4c;">Các sản phẩm bạn đã theo dõi</h2>

        @if (Model.Any())
        {
            <div class="row g-4">
                @foreach (var product in Model)
                {
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="card product-card shadow-sm border-0 h-100">
                            <div class="position-relative overflow-hidden" style="height: 240px;">
                                <img src="@product.ImageUrl" class="card-img-top img-fluid" alt="@product.Name"
                                     style="object-fit: cover; height: 100%; transition: transform 0.3s;">
                                <div class="overlay d-flex align-items-center justify-content-center">
                                    <a href="@Url.Action("Details", "Product", new { id = product.Id })"
                                       class="btn btn-light btn-sm text-dark">Chi tiết</a>
                                </div>
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title text-center" style="font-weight: 600;">@product.Name</h5>
                                <p class="card-text text-muted text-truncate">@product.Description</p>
                                <div class="d-flex justify-content-between mt-auto">
                                    <a href="@Url.Action("Details", "Product", new { id = product.Id })"
                                       class="btn btn-outline-primary btn-sm">
                                        <i class="fa fa-info-circle me-1"></i> Xem chi tiết
                                    </a>
                                    <button id="follow-button-@product.Id" class="btn btn-danger btn-sm" onclick="toggleFollow(@product.Id)">
                                        Bỏ theo dõi
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <p class="text-center text-muted" style="font-size: 1.2rem; margin-top: 50px;">
                Bạn chưa theo dõi sản phẩm nào.
            </p>
        }
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        async function toggleFollow(productId) {
            const followButton = document.getElementById(`follow-button-${productId}`);
            const isFollowing = followButton.textContent.trim() === 'Bỏ theo dõi';

            const url = isFollowing ? '/Follow/UnfollowProduct' : '/Follow/FollowProduct';
            const method = 'POST';
            const body = JSON.stringify(productId);

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: body
                });

                if (response.ok) {
                    const result = await response.json();
                    alert(result.message);
                    if (isFollowing) {
                        followButton.closest('.col-lg-3').remove(); // Xóa sản phẩm khỏi danh sách sau khi bỏ theo dõi thành công
                    }
                } else {
                    const error = await response.json();
                    alert(error.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Có lỗi xảy ra, vui lòng thử lại sau.');
            }
        }
    </script>


    <!-- Footer Section Begin -->
    <footer class="footer">
        <div class="page-up">
            <a href="#" id="scrollToTopButton"><span class="arrow_carrot-up"></span></a>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-lg-3"></div>
                <div class="col-lg-6">
                    <div class="footer__nav">
                        <ul>
                            <li>
                                <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Index">
                                    Homepage
                                </a>

                            <li>
                                <a class="nav-link text-dark" asp-area="" asp-controller="Categories" asp-action="Index">Categories</a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link text-dark" asp-area="" asp-controller="Blog" asp-action="Index">
                                    Our Blog
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->
    <!-- Js Plugins -->
    <script src="/js/jquery-3.3.1.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/player.js"></script>
    <script src="/js/jquery.nice-select.min.js"></script>
    <script src="/js/mixitup.min.js"></script>
    <script src="/js/jquery.slicknav.js"></script>
    <script src="/js/owl.carousel.min.js"></script>
    <script src="/js/main.js"></script>

    <script>
        function incrementViewCount(productId) {
            fetch('/Home/IncrementViewCount', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRF-TOKEN': $('input[name="__RequestVerificationToken"]').val() // Nếu bạn có CSRF token
                },
                body: new URLSearchParams({ id: productId })
            }).then(response => {
                if (!response.ok) {
                    console.error('Error increasing view count');
                }
            }).catch(error => console.error('Error:', error));
        }
    </script>
</body>

</html>